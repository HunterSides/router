"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5556],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),m=o,f=c["".concat(s,".").concat(m)]||c[m]||d[m]||a;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4933:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={title:"Async Routes"},i=void 0,l={unversionedId:"lab/bundle-splitting",id:"lab/bundle-splitting",title:"Async Routes",description:"This guide requires expo@49.0.0-alpha.3 or greater\u2013\u2013everything listed here is still experimental. You may need to use Expo CLI on main to use these features.",source:"@site/docs/lab/bundle-splitting.md",sourceDirName:"lab",slug:"/lab/bundle-splitting",permalink:"/router/docs/lab/bundle-splitting",draft:!1,editUrl:"https://github.com/expo/router/tree/main/docs/docs/lab/bundle-splitting.md",tags:[],version:"current",frontMatter:{title:"Async Routes"},sidebar:"tutorialSidebar",previous:{title:"Troubleshooting",permalink:"/router/docs/troubleshooting"},next:{title:"Handoff",permalink:"/router/docs/lab/handoff"}},s={},u=[{value:"Setup",id:"setup",level:2},{value:"Development",id:"development",level:2},{value:"Production",id:"production",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Static Rendering",id:"static-rendering",level:3}],p={toc:u};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This guide requires ",(0,o.kt)("inlineCode",{parentName:"p"},"expo@49.0.0-alpha.3")," or greater\u2013\u2013everything listed here is still experimental. You may need to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/expo/expo/tree/main/packages/%40expo/cli#contributing"},"use Expo CLI on ",(0,o.kt)("inlineCode",{parentName:"a"},"main"))," to use these features.")),(0,o.kt)("p",null,"Expo Router can automatically split your JavaScript bundle based on the route files, using ",(0,o.kt)("a",{parentName:"p",href:"https://react.dev/reference/react/Suspense"},"React Suspense"),". This enables faster development as only the routes you navigate to will be bundled/loaded into memory. This can also be useful for reducing the initial bundle size for your application."),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("p",null,"Configure Metro to use Expo's bundle splitting features:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=metro.config.js",title:"metro.config.js"},'const { getDefaultConfig } = require("@expo/metro-config");\n\nconst config = getDefaultConfig(__dirname);\n\nconfig.transformer = {\n  ...config.transformer,\n  asyncRequireModulePath: require.resolve("@expo/metro-runtime/async-require"),\n};\n\nconfig.server = {\n  ...config.server,\n  experimentalImportBundleSupport: true,\n};\n\nmodule.exports = config;\n')),(0,o.kt)("p",null,"Next, enable the feature:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"title=app.json",title:"app.json"},'{\n  "expo": {\n    "plugins": [\n      [\n        "expo-router",\n        {\n          "origin": "https://acme.com",\n          // highlight-next-line\n          "asyncRoutes": "development"\n        }\n      ]\n    ]\n  }\n}\n')),(0,o.kt)("p",null,"Now you'll need to clear the bundler cache: ",(0,o.kt)("inlineCode",{parentName:"p"},"npx expo start --clear")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"npx expo export --clear")),(0,o.kt)("h2",{id:"development"},"Development"),(0,o.kt)("p",null,"Metro Bundler has a special development-only bundle splitting feature which can be used to defer bundling unused code until it is needed. This system was developed at Meta for incrementally developing the Facebook app at scale, Expo Router enables you to use it automatically!"),(0,o.kt)("h2",{id:"production"},"Production"),(0,o.kt)("p",null,"Production bundle splitting is still in development. When you bundle for production, all suspense boundaries will be disabled and there will be no loading states."),(0,o.kt)("p",null,"Apps using the Hermes Engine will not benefit much from bundle splitting as the bytecode is already memory mapped ahead of time. We plan to add support regardless for faster over-the-air updates, React Server Components, and web support."),(0,o.kt)("h2",{id:"how-it-works"},"How it works"),(0,o.kt)("p",null,"All Routes are loaded asynchronously, and loaded inside a suspense boundary. This means that the first time you navigate to a route, it will take a little longer to load. However, once it is loaded, it will be cached and subsequent visits will be instant. The ",(0,o.kt)("a",{parentName:"p",href:"https://react.dev/reference/react/Suspense#displaying-a-fallback-while-content-is-loading"},"Suspense fallback")," or loading state ",(0,o.kt)("strong",{parentName:"p"},"cannot be customized")," at this time, we plan to add support in the future via a ",(0,o.kt)("inlineCode",{parentName:"p"},"<route>+loading.js")," file."),(0,o.kt)("p",null,"Loading errors are handled in the parent route, via the ",(0,o.kt)("a",{parentName:"p",href:"/docs/features/errors"},(0,o.kt)("inlineCode",{parentName:"a"},"ErrorBoundary"))," export. This will probably be refactored in the future to use a ",(0,o.kt)("inlineCode",{parentName:"p"},"<route>+error.js")," file."),(0,o.kt)("p",null,"Async routes cannot be statically filtered during development, so all files will be treated as routes even if they don't export a default component. After the component is bundled and loaded, then any invalid route will use a fallback warning screen. This behavior is development-only and will not be present in production."),(0,o.kt)("h3",{id:"static-rendering"},"Static Rendering"),(0,o.kt)("p",null,"The current static rendering system doesn't support React Suspense, so we have to disable it when rendering static pages. This will be improved in the future."))}d.isMDXComponent=!0}}]);